<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.Eparking.dao.UserMapper">

    <resultMap id = "listNotifications" type = "com.project.Eparking.domain.Notifications">
        <result property = "notiID" column = "notiID"/>
        <result property = "recipient_type" column = "recipient_type"/>
        <result property = "recipient_id" column = "recipient_id"/>
        <result property = "sender_type" column = "sender_type"/>
        <result property = "sender_id" column = "sender_id"/>
        <result property = "content" column = "content"/>
        <result property = "created_at" column = "created_at"/>
        <result property = "imageLink" column = "imageLink"/>
    </resultMap>

    <select id="getAdminByAdminID" resultType="com.project.Eparking.domain.Admin">
        SELECT
            adminID,
            image,
            role,
            phoneNumber,
            fullName,
            password,
            email,
            status
        FROM admin
        WHERE adminID = #{adminID};
    </select>

    <select id="getCustomerByCustomerID" resultType="com.project.Eparking.domain.Customer">
        SELECT
            customerID,
            wallet_balance AS walletBalance,
            identify,
            role,
            phoneNumber,
            fullName,
            password,
            email,
            status,
            registrationDate
        FROM customer
        WHERE customerID = #{customerID};
    </select>

    <select id="getPLOByPLOID" resultType="com.project.Eparking.domain.PLO">
        SELECT
            ploID,
            balance,
            phoneNumber,
            fullName,
            password,
            email,
            status,
            identify,
            parkingName,
            Description,
            address,
            latitude,
            longtitude,
            parkingStatusID,
            slot,
            currentSlot,
            role,
            length,
            width,
            waitingTime,
            cancelBookingTime,
            contractLink,
            registerContract,
            browseContract,
            contractDuration
        FROM plo
        WHERE ploID = #{ploID};
    </select>

    <select id="getResponseCustomerByCustomerID" resultType="com.project.Eparking.domain.response.ResponseCustomer">
        SELECT
        customerID,
        role,
        phoneNumber,
        fullName,
        email
        FROM customer
        WHERE customerID = #{customerID};
    </select>

    <select id="getPLOResponseByPLOID" resultType="com.project.Eparking.domain.response.ResponsePLO">
        SELECT
        ploID,
        phoneNumber,
        fullName,
        email,
        plo.parkingStatusID,
        parkingstatus.statusName,
        address,
        role
        FROM plo,parkingstatus
        WHERE ploID = #{ploID} AND plo.parkingStatusID = parkingstatus.parkingStatusID;
    </select>

    <select id="getAdminResponseByAdminID" resultType="com.project.Eparking.domain.response.ResponseAdmin">
        SELECT
        adminID,
        image,
        role,
        phoneNumber,
        fullName,
        email
        FROM admin
        WHERE adminID = #{adminID};
    </select>

    <select id="getCustomerResponseByPhonenumber" resultType="com.project.Eparking.domain.response.ResponseCustomer">
        SELECT
        customerID,
        role,
        phoneNumber,
        fullName,
        email
        FROM customer
        WHERE phoneNumber = #{phoneNumber};
    </select>
    <select id="getPLOResponseByPhonenumber" resultType="com.project.Eparking.domain.response.ResponsePLO">
        SELECT
        ploID,
        phoneNumber,
        fullName,
        email,
        plo.parkingStatusID,
        parkingstatus.statusName
        FROM plo,parkingstatus
        WHERE phoneNumber = #{phoneNumber} AND plo.parkingStatusID = parkingstatus.parkingStatusID;
    </select>

    <insert id="createPLO" parameterType="com.project.Eparking.domain.request.RequestRegisterUser" >
        INSERT INTO plo (ploID, balance, phoneNumber, fullName, password, status, parkingStatusID,role)
        VALUES (#{ploID}, #{balance}, #{user.phoneNumber}, #{user.fullName}, #{user.password}, #{status}, #{parkingStatusID},#{user.role})
    </insert>
    <insert id="createCustomer" parameterType="com.project.Eparking.domain.request.RequestRegisterUser" >
        INSERT INTO customer (customerID, wallet_balance, role, phoneNumber, fullName, password,status)
        VALUES (#{customerID}, #{wallet_balance}, #{user.role}, #{user.phoneNumber}, #{user.fullName}, #{user.password},#{status});
    </insert>
    <update id="updateStatusCustomerPhoneNumber" parameterType="com.project.Eparking.domain.Customer">
        UPDATE customer
        SET status = #{status}
        WHERE customerID = #{customerID}
    </update>
    <update id="updateNewPasswordPLO" parameterType="com.project.Eparking.domain.request.RequestChangePassword">
        UPDATE plo
        SET password = #{password.password}
        WHERE ploID = #{ID}
    </update>
    <update id="updateNewPasswordCustomer" parameterType="com.project.Eparking.domain.request.RequestChangePassword">
        UPDATE customer
        SET password = #{password.password}
        WHERE customerID = #{ID}
    </update>
    <select id="getPLOProfileResponseByPLOID" resultType="com.project.Eparking.domain.response.ResponsePLOProfile">
        SELECT
            ploID,
            phoneNumber,
            fullName,
            email
        FROM plo
        WHERE ploID = #{ploID}
    </select>
    <update id="updatePLOprofile" parameterType="com.project.Eparking.domain.response.ResponsePLOProfile">
        UPDATE plo
        SET fullName = #{profile.fullName},
            email = #{profile.email}
        WHERE ploID = #{ID}
    </update>
    <select id="getParkingInformationByPLOID" resultType="com.project.Eparking.domain.ParkingInformation">
        SELECT
            ploID,
            parkingName,
            description,
            address,
            slot,
            length,
            width,
            waitingTime,
            cancelBookingTime
        FROM plo
        WHERE ploID = #{ploID}
    </select>
    <select id="getBalancePlO" resultType="double">
        SELECT balance
        FROM plo
        WHERE ploID = #{ploID}
    </select>

    <select id="getListNotificationByID" resultMap="listNotifications">
        SELECT notiID,recipient_type,recipient_id,sender_type,sender_id,content,created_at,imageLink
        FROM notifications
        WHERE recipient_id = #{recipientID}
        ORDER BY created_at DESC;
    </select>
    <insert id="insertNotification" parameterType="com.project.Eparking.domain.Notifications">
        INSERT INTO notifications(recipient_type,recipient_id,sender_type,sender_id,content,created_at,imageLink)
        VALUES(#{recipient_type},#{recipient_id},#{sender_type},#{sender_id},#{content},#{created_at},#{imageLink})
    </insert>
</mapper>